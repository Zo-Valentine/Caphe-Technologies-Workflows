{
  "name": "License & Credential Verification",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule - Every 6 Hours",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "operation": "read",
        "sheetId": "={{ $env.GOOGLE_SHEET_ID }}",
        "range": "Candidates!A:M",
        "options": {
          "headerRow": 1
        }
      },
      "id": "get-candidates",
      "name": "Get Candidates Needing Verification",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [450, 300],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-oauth",
          "name": "Google Sheets Account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "id": "needs-verification",
              "leftValue": "={{ $json.verification_status }}",
              "rightValue": "Pending",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "has-license",
              "leftValue": "={{ $json.license_number }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "filter-pending",
      "name": "Filter Pending Verifications",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "url": "=https://www.ncsbn.org/api/v1/nurse/verification",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "license_number",
              "value": "={{ $json.license_number }}"
            },
            {
              "name": "state",
              "value": "={{ $json.license_state }}"
            },
            {
              "name": "license_type",
              "value": "={{ $json.position }}"
            }
          ]
        },
        "options": {
          "timeout": 10000
        }
      },
      "id": "verify-license-ncsbn",
      "name": "Verify License - NCSBN API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [850, 200],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ncsbn-api-key",
          "name": "NCSBN API Key"
        }
      },
      "notes": "Note: This is a mock API endpoint. Replace with actual state nursing board API"
    },
    {
      "parameters": {
        "url": "={{ $env.STATE_LICENSE_API_BASE }}/{{ $json.license_state }}/verify",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \"license_number\": $json.license_number, \"license_type\": $json.position, \"date_check\": $now.toISO() } }}",
        "options": {
          "timeout": 10000
        }
      },
      "id": "verify-state-board",
      "name": "Verify with State Board",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [850, 400],
      "credentials": {
        "httpHeaderAuth": {
          "id": "state-board-api",
          "name": "State Board API"
        }
      },
      "notes": "Backup verification via state-specific nursing board APIs"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "verification-status",
              "name": "verification_status",
              "value": "={{ $json.status === 'active' || $json.license_status === 'active' ? 'Verified' : 'Invalid' }}",
              "type": "string"
            },
            {
              "id": "expiration-date",
              "name": "expiration_date",
              "value": "={{ $json.expiration_date || $json.license_expiration }}",
              "type": "string"
            },
            {
              "id": "verification-date",
              "name": "verification_date",
              "value": "={{ $now.toISO() }}",
              "type": "string"
            },
            {
              "id": "is-expired",
              "name": "is_expired",
              "value": "={{ new Date($json.expiration_date || $json.license_expiration) < new Date() }}",
              "type": "boolean"
            },
            {
              "id": "discipline-flag",
              "name": "has_disciplinary_action",
              "value": "={{ $json.disciplinary_actions ? true : false }}",
              "type": "boolean"
            }
          ]
        },
        "options": {}
      },
      "id": "process-results",
      "name": "Process Verification Results",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {},
          "conditions": [
            {
              "id": "is-verified",
              "leftValue": "={{ $json.verification_status }}",
              "rightValue": "Verified",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "not-expired",
              "leftValue": "={{ $json.is_expired }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            },
            {
              "id": "no-discipline",
              "leftValue": "={{ $json.has_disciplinary_action }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-pass",
      "name": "Check if Passes Verification",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "operation": "update",
        "sheetId": "={{ $env.GOOGLE_SHEET_ID }}",
        "range": "=Candidates!A{{ $json.row_number }}:M{{ $json.row_number }}",
        "options": {
          "valueInputMode": "USER_ENTERED"
        }
      },
      "id": "update-passed",
      "name": "Update Sheet - Verified",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1450, 200],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-oauth",
          "name": "Google Sheets Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "sheetId": "={{ $env.GOOGLE_SHEET_ID }}",
        "range": "=Candidates!A{{ $json.row_number }}:M{{ $json.row_number }}",
        "options": {
          "valueInputMode": "USER_ENTERED"
        }
      },
      "id": "update-failed",
      "name": "Update Sheet - Failed",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1450, 400],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-oauth",
          "name": "Google Sheets Account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "={{ $env.RECRUITER_EMAIL }}",
        "toEmail": "={{ $env.RECRUITER_EMAIL }}",
        "subject": "=âœ… License Verified: {{ $('Get Candidates Needing Verification').item.json.applicant_name }}",
        "emailType": "text",
        "message": "=License verification PASSED for {{ $('Get Candidates Needing Verification').item.json.applicant_name }}\\n\\nâœ… License Status: Active\\nðŸ†” License Number: {{ $('Get Candidates Needing Verification').item.json.license_number }}\\nðŸ“ State: {{ $('Get Candidates Needing Verification').item.json.license_state }}\\nðŸ“… Expiration: {{ $json.expiration_date }}\\nâœ“ No Disciplinary Actions\\n\\nCandidate is cleared to proceed to next stage.",
        "options": {}
      },
      "id": "email-passed",
      "name": "Email - Verification Passed",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [1650, 200],
      "credentials": {
        "smtp": {
          "id": "smtp-credentials",
          "name": "SMTP Account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "={{ $env.RECRUITER_EMAIL }}",
        "toEmail": "={{ $env.RECRUITER_EMAIL }}",
        "subject": "=âš ï¸ License Verification Failed: {{ $('Get Candidates Needing Verification').item.json.applicant_name }}",
        "emailType": "text",
        "message": "=License verification FAILED for {{ $('Get Candidates Needing Verification').item.json.applicant_name }}\\n\\nâŒ Issues Found:\\n{{ $json.is_expired ? '- License is EXPIRED\\n' : '' }}{{ $json.has_disciplinary_action ? '- Disciplinary actions on record\\n' : '' }}{{ $json.verification_status === 'Invalid' ? '- License not found or invalid\\n' : '' }}\\nðŸ†” License Number: {{ $('Get Candidates Needing Verification').item.json.license_number }}\\nðŸ“ State: {{ $('Get Candidates Needing Verification').item.json.license_state }}\\n\\nManual review required before proceeding.",
        "options": {}
      },
      "id": "email-failed",
      "name": "Email - Verification Failed",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [1650, 400],
      "credentials": {
        "smtp": {
          "id": "smtp-credentials",
          "name": "SMTP Account"
        }
      }
    }
  ],
  "connections": {
    "Schedule - Every 6 Hours": {
      "main": [
        [
          {
            "node": "Get Candidates Needing Verification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Candidates Needing Verification": {
      "main": [
        [
          {
            "node": "Filter Pending Verifications",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Pending Verifications": {
      "main": [
        [
          {
            "node": "Verify License - NCSBN API",
            "type": "main",
            "index": 0
          },
          {
            "node": "Verify with State Board",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verify License - NCSBN API": {
      "main": [
        [
          {
            "node": "Process Verification Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verify with State Board": {
      "main": [
        [
          {
            "node": "Process Verification Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Verification Results": {
      "main": [
        [
          {
            "node": "Check if Passes Verification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Passes Verification": {
      "main": [
        [
          {
            "node": "Update Sheet - Verified",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Sheet - Failed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Sheet - Verified": {
      "main": [
        [
          {
            "node": "Email - Verification Passed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Sheet - Failed": {
      "main": [
        [
          {
            "node": "Email - Verification Failed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-11-19T00:00:00.000Z",
  "versionId": "1"
}
